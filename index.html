<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Invoice Extractor ‚Äî AI Powered</title>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Orbitron:wght@500&display=swap" rel="stylesheet">

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :root {
      --transition-speed: 0.4s;
      --neon-blue: #00ffff;
      --neon-pink: #ff00ff;
      --dark-bg: #0d1117;
      --light-bg: #f9fafb;
      --dark-card: #161b22;
      --light-card: #ffffff;
    }

    html, body {
      font-family: 'Inter', sans-serif;
      height: 100%;
      width: 100%;
      margin: 0;
      padding: 0;
      transition: background var(--transition-speed), color var(--transition-speed);
      overflow-x: hidden;
    }

    body.light {
      background: var(--light-bg);
      color: #111;
    }

    body.dark {
      background: var(--dark-bg);
      color: #e5e5e5;
    }

    .card {
      transition: all var(--transition-speed);
      border-radius: 1rem;
      box-shadow: 0 0 25px rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(12px);
    }

    .dark .card {
      background: rgba(22, 27, 34, 0.95);
    }

    .light .card {
      background: rgba(255, 255, 255, 0.95);
    }

    .gradient-text {
      background: linear-gradient(90deg, var(--neon-blue), var(--neon-pink));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    /* File drop area */
    .dropzone {
      border: 2px dashed var(--neon-blue);
      border-radius: 1rem;
      padding: 3rem;
      text-align: center;
      transition: 0.3s;
    }

    .dropzone.dragover {
      border-color: var(--neon-pink);
      transform: scale(1.05);
    }

    /* Buttons */
    .btn {
      font-weight: 600;
      transition: 0.3s ease;
      cursor: pointer;
    }

    .btn-primary {
      background: linear-gradient(90deg, var(--neon-blue), var(--neon-pink));
      color: #fff;
      border-radius: 0.5rem;
      padding: 0.75rem 1.5rem;
    }

    .btn-primary:hover {
      transform: scale(1.05);
      box-shadow: 0 0 15px var(--neon-pink);
    }

    .toggle-switch {
      position: relative;
      width: 60px;
      height: 30px;
      background: #ccc;
      border-radius: 30px;
      transition: 0.4s;
    }

    .toggle-switch::after {
      content: '';
      position: absolute;
      width: 24px;
      height: 24px;
      top: 3px;
      left: 3px;
      background: white;
      border-radius: 50%;
      transition: 0.4s;
    }

    body.dark .toggle-switch {
      background: #4b5563;
    }

    body.dark .toggle-switch::after {
      left: 33px;
      background: var(--neon-blue);
    }

    /* Typing animation */
    .typing {
      font-family: monospace;
      white-space: pre-wrap;
      overflow-wrap: break-word;
      border-left: 3px solid var(--neon-pink);
      padding-left: 8px;
      animation: blink 1s infinite step-start;
    }

    @keyframes blink {
      50% {
        border-color: transparent;
      }
    }

    /* Success / Fail animations */
    @keyframes successAnim {
      0% { transform: scale(0.8); opacity: 0; }
      100% { transform: scale(1); opacity: 1; }
    }

    .success {
      color: #22c55e;
      animation: successAnim 0.6s ease-out;
    }

    .error {
      color: #ef4444;
      animation: successAnim 0.6s ease-out;
    }

    /* Smooth fade-in */
    .fade-in {
      opacity: 0;
      transform: translateY(10px);
      animation: fadeIn 1s forwards ease-out;
    }

    @keyframes fadeIn {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

  </style>
</head>

<body class="dark">

  <!-- Navbar -->
  <nav class="flex items-center justify-between px-8 py-4 border-b border-gray-600 backdrop-blur-md card fade-in">
    <h1 class="text-2xl font-bold gradient-text">Invoice Extractor AI</h1>
    <div class="flex items-center space-x-4">
      <span id="themeLabel" class="text-sm">Dark</span>
      <div class="toggle-switch" id="themeToggle"></div>
    </div>
  </nav>

  <!-- Main Container -->
  <main class="flex flex-col items-center justify-center px-6 py-10 space-y-10 fade-in">

    <section class="card p-8 max-w-4xl w-full text-center">

      <h2 class="text-3xl font-semibold gradient-text mb-4">Upload & Extract Invoice</h2>
      <p class="mb-6 opacity-80">AI-powered PDF extraction using GROQ + Flask backend</p>

      <!-- File Upload -->
      <div id="dropzone" class="dropzone mx-auto w-full md:w-2/3 text-center">
        <p class="mb-2">üìÑ Drag & Drop your invoice or click to upload</p>
        <input type="file" id="fileInput" accept="application/pdf" class="hidden" />
        <button id="uploadBtn" class="btn btn-primary mt-3">Upload & Extract ‚ûú</button>
      </div>

      <!-- Extraction Info -->
      <div id="statusArea" class="mt-6 hidden">
        <div class="flex flex-col md:flex-row justify-around items-center gap-4">
          <div>
            <p class="font-semibold">Invoice Number</p>
            <p id="invoiceNumber" class="text-lg"></p>
          </div>
          <div>
            <p class="font-semibold">Invoice Date</p>
            <p id="invoiceDate" class="text-lg"></p>
          </div>
          <div>
            <p class="font-semibold">Total Amount</p>
            <p id="totalAmount" class="text-lg"></p>
          </div>
        </div>
      </div>

      <!-- AI Typing Preview -->
      <div id="resultContainer" class="mt-8 p-4 card overflow-y-auto max-h-[400px] text-left hidden">
        <h3 class="text-xl font-semibold mb-2 gradient-text">AI Extracted Data</h3>
        <pre id="aiOutput" class="typing text-sm"></pre>
      </div>

      <!-- Status Animation -->
      <div id="statusMsg" class="mt-6 text-lg font-semibold"></div>
    </section>

    <footer class="text-center opacity-70 text-sm mt-10">
      <p>Powered by Flask + GROQ LLM | Designed by <span class="gradient-text">Rajeswaran</span></p>
    </footer>
  </main>

  <script>
    const BACKEND_URL = "https://invoice-extractor-2-835j.onrender.com/extract";
    const themeToggle = document.getElementById("themeToggle");
    const themeLabel = document.getElementById("themeLabel");
    const fileInput = document.getElementById("fileInput");
    const dropzone = document.getElementById("dropzone");
    const uploadBtn = document.getElementById("uploadBtn");
    const aiOutput = document.getElementById("aiOutput");
    const statusArea = document.getElementById("statusArea");
    const resultContainer = document.getElementById("resultContainer");
    const statusMsg = document.getElementById("statusMsg");
    const invoiceNumber = document.getElementById("invoiceNumber");
    const invoiceDate = document.getElementById("invoiceDate");
    const totalAmount = document.getElementById("totalAmount");

    // Theme Switch
    themeToggle.addEventListener("click", () => {
      document.body.classList.toggle("dark");
      document.body.classList.toggle("light");
      const isDark = document.body.classList.contains("dark");
      themeLabel.textContent = isDark ? "Dark" : "Light";
    });

    // Dropzone Effects
    dropzone.addEventListener("click", () => fileInput.click());
    dropzone.addEventListener("dragover", (e) => {
      e.preventDefault();
      dropzone.classList.add("dragover");
    });
    dropzone.addEventListener("dragleave", () => dropzone.classList.remove("dragover"));
    dropzone.addEventListener("drop", (e) => {
      e.preventDefault();
      dropzone.classList.remove("dragover");
      fileInput.files = e.dataTransfer.files;
      startExtraction();
    });

    uploadBtn.addEventListener("click", startExtraction);

    async function startExtraction() {
      const file = fileInput.files[0];
      if (!file) {
        alert("Please select a PDF file first.");
        return;
      }

      const formData = new FormData();
      formData.append("file", file);

      statusMsg.textContent = "Uploading and extracting...";
      statusMsg.className = "text-blue-400 animate-pulse";

      try {
        const response = await fetch(BACKEND_URL, { method: "POST", body: formData });
        const data = await response.json();

        if (!response.ok) throw new Error(data.message || "Extraction failed");

        invoiceNumber.textContent = data.parsed_basic?.invoice_number || "N/A";
        invoiceDate.textContent = data.parsed_basic?.invoice_date || "N/A";
        totalAmount.textContent = data.parsed_basic?.total_amount || "N/A";

        statusArea.classList.remove("hidden");
        resultContainer.classList.remove("hidden");
        aiOutput.textContent = "";

        const rawText = data.content || "No content extracted.";
        await typeText(aiOutput, rawText, 15);

        statusMsg.textContent = "‚úÖ Extraction Successful!";
        statusMsg.className = "success";

      } catch (err) {
        statusMsg.textContent = "‚ùå Extraction Failed: " + err.message;
        statusMsg.className = "error";
      }
    }

    async function typeText(element, text, speed) {
      element.textContent = "";
      for (let i = 0; i < text.length; i++) {
        element.textContent += text[i];
        await new Promise((r) => setTimeout(r, speed));
      }
    }

    // Smooth page load
    window.addEventListener("load", () => {
      document.body.classList.add("fade-in");
    });
  </script>
</body>
</html>
